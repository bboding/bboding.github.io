name: release

on:
  release:
    types: [published]

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
      - name: action-slack
        uses: 8398a7/action-slack@v3.5.0
        with:
          status: ${{ job.status }}
          text: "[ncnc-scripts v${{ github.event.release.tag_name }}] 릴리즈를 시작합니다."
        env:
          SLACK_WEBHOOK_URL: https://hooks.slack.com/services/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
      - name: Checkout
        uses: actions/checkout@v2.3.1
      - name: Build and push Docker images
        uses: docker/build-push-action@v1.1.0
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
          repository: doublencinc/ncnc-scripts
          tag_with_ref: true
      - name: action-slack
        uses: 8398a7/action-slack@v3.5.0
        with:
          status: ${{ job.status }}
          fields: repo,took
          text: "[ncnc-scripts v${{ github.event.release.tag_name }}] 도커 이미지가 등록되었습니다. ${{job.status}}"
        env:
          SLACK_WEBHOOK_URL: https://hooks.slack.com/services/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
